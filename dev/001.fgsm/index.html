<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FGSM · Adversarial.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Adversarial.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>FGSM</a></li></ul></li><li><a class="tocitem" href="../blackbox/">BlackBox</a></li><li><a class="tocitem" href="../whitebox/">WhiteBox</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>FGSM</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FGSM</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jaypmorgan/Adversarial.jl/blob/master/docs/src/001.fgsm.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="FGSM-for-Adversarial-Attacks"><a class="docs-heading-anchor" href="#FGSM-for-Adversarial-Attacks">FGSM for Adversarial Attacks</a><a id="FGSM-for-Adversarial-Attacks-1"></a><a class="docs-heading-anchor-permalink" href="#FGSM-for-Adversarial-Attacks" title="Permalink"></a></h1><p>FGSM is a simple algorithm that ...</p><p>first we can import the Adversarial Module and access the MNIST data from Flux</p><pre><code class="language-julia">using Adversarial
using Flux
using Flux: update!
using Flux.Data.MNIST
using Statistics
# using Flux.Tracker: gradient, update!
# using CuArrays # comment out if a GPU is not available
using Plots</code></pre><p>next we will load the training. For the example, we will only perform adversarial attacks on this data</p><pre><code class="language-julia">train_images = MNIST.images();
train_labels = MNIST.labels();</code></pre><p>A function to conver the images to arrays</p><pre><code class="language-julia">function minibatch(i, batch_size = 32)
    x_batch = Array{Float32}(undef, size(train_images[1])..., 1, batch_size)
    y_batch = Flux.onehotbatch(train_labels[i:i+batch_size-1], 0:9)
    for (idx, image) in enumerate(train_images[i:i+batch_size-1])
        x_batch[:,:,1,idx] = Float32.(image)
    end
    return x_batch |&gt; gpu, y_batch |&gt; gpu
end</code></pre><pre><code class="language-none">minibatch (generic function with 2 methods)</code></pre><p>We then create and train a simple CNN.</p><pre><code class="language-julia">CNN() = Chain(
    Conv((3, 3), 1=&gt;16, pad=(1,1), relu),
    MaxPool((2,2)),
    Conv((3, 3), 16=&gt;32, pad=(1,1), relu),
    MaxPool((2,2)),
    Conv((3, 3), 32=&gt;32, pad=(1,1), relu),
    MaxPool((2,2)),
    x -&gt; reshape(x, :, size(x, 4)),
    Dense(288, 10),
    softmax) |&gt; gpu

m = CNN();
θ = params(m);
loss(x, y) = Flux.crossentropy(m(x), y)
acc(x, y) = mean(Flux.onecold(m(x)) |&gt; cpu .== Flux.onecold(y) |&gt; cpu)
opt = ADAM()</code></pre><pre><code class="language-none">ADAM(0.001, (0.9, 0.999), IdDict{Any,Any}())</code></pre><p>now for our training loop...</p><pre><code class="language-julia">const EPOCHS = 5
const BATCH_SIZE = 32

for epoch in 1:EPOCHS
    losses = 0.
    accuracies = 0.
    steps = 0

    for i in 1:BATCH_SIZE:size(train_images,1)-BATCH_SIZE
        local l;
        x, y = minibatch(i)
        gs = gradient(θ) do
            l = loss(x, y)
            return l
        end
        a = acc(x, y)

        update!(opt, θ, gs)

        losses += (l |&gt; cpu)
        accuracies += (a |&gt; cpu)
        steps += 1
    end
    @info &quot;Epoch $epoch end. Loss: $(losses / steps), Acc: $(accuracies / steps)&quot;
end</code></pre><p>Now that we have a &quot;trained&quot; model, lets create some adversarial examples using the FGSM method.</p><p>Let&#39;s begin with a single image</p><pre><code class="language-julia">x, y = minibatch(1, 1)
x_adv = FGSM(m, loss, x, y; ϵ = 0.07)

# we can see that the predicted labels are different
adversarial_pred = m(x_adv) |&gt; Flux.onecold |&gt; getindex
original_pred = m(x) |&gt; Flux.onecold |&gt; getindex</code></pre><pre><code class="language-none">6</code></pre><p>and visualise the resulting adversarial in comparison to the original image. When using an ϵ value of 0.07, the different is very slight, if noticable at all.</p><pre><code class="language-julia">l = @layout [a b]
adv = heatmap(permutedims(x_adv, (4, 3, 1, 2))[1,1,:,:] |&gt; cpu)
org = heatmap(permutedims(x, (4, 3, 1, 2))[1,1,:,:] |&gt; cpu)
plot(org, adv, layout = l)

@assert adversarial_pred != original_pred</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../blackbox/">BlackBox »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 20 January 2021 12:09">Wednesday 20 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
